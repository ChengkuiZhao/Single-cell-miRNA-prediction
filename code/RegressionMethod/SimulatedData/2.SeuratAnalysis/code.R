/N/u/cz18/Carbonate/software/R-3.5.3/bin/R
library(dplyr)
library(Seurat)
load(file='data_simulation(10000).Rdata')
data=data_var0.2
remove(data_var0.2)
pbmc=CreateSeuratObject(counts=data,project='pbmc10k',min.cells=3,min.features=200)
pbmc[['percent.mt']]=PercentageFeatureSet(pbmc,pattern='^MT-')

pdf('VlnPlot.pdf')
VlnPlot(pbmc,features=c('nFeature_RNA','nCount_RNA'),ncol=2)
dev.off()
pdf('FeatureScatter.pdf')
FeatureScatter(pbmc,feature1='nCount_RNA',feature2='nFeature_RNA')
dev.off()
pbmc <- NormalizeData(pbmc, normalization.method = "LogNormalize", scale.factor = 10000)
pdf('FindVariableFeatures.pdf')
VariableFeaturePlot(pbmc)
dev.off()

all.genes <- rownames(pbmc)
pbmc <- ScaleData(pbmc, features = all.genes)
pbmc <- RunPCA(pbmc, features = VariableFeatures(object = pbmc))
pdf('Elbow.pdf')
ElbowPlot(pbmc)
dev.off()
pbmc <- FindNeighbors(pbmc, dims = 1:10)
pbmc <- FindClusters(pbmc, resolution = 0.1)
pdf('TSNE.pdf')
pbmc <- RunTSNE(pbmc,dims=1:10)
DimPlot(pbmc,reduction='tsne')
dev.off()
pdf('UMAP.pdf')
pbmc <- RunUMAP(pbmc,dims=1:10)
DimPlot(pbmc, reduction = "umap")
dev.off()

Idents(pbmc)=as.factor(label_true[202,])
pdf('TSNE_Label_True(hsa-miR-127-3p).pdf')
DimPlot(pbmc,reduction='tsne',do.label=T,cols=heat.colors(10))
dev.off()

Idents(pbmc)=as.factor(label_predict[202,])
pdf('TSNE_Label_Predict(hsa-miR-127-3p).pdf')
DimPlot(pbmc,reduction='tsne',do.label=T,cols=heat.colors(10))
dev.off()

